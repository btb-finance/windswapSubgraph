# Comprehensive CL Subgraph for WindSwap

# Protocol-wide statistics
type Protocol @entity {
  id: ID! # "windswap"
  totalVolumeUSD: BigDecimal!
  totalTVLUSD: BigDecimal!
  totalPools: BigInt!
  totalSwaps: BigInt!
}

# Token entity
type Token @entity {
  id: ID! # token address
  symbol: String!
  name: String!
  decimals: Int!
  totalVolumeUSD: BigDecimal!
  pools: [Pool!]! @derivedFrom(field: "token0")
}

# CL Pool entity with full tracking
type Pool @entity {
  id: ID! # pool address
  token0: Token!
  token1: Token!
  tickSpacing: Int!
  sqrtPriceX96: BigInt!
  tick: Int!
  liquidity: BigInt!
  
  # TVL tracking
  totalValueLockedToken0: BigDecimal!
  totalValueLockedToken1: BigDecimal!
  totalValueLockedUSD: BigDecimal!
  
  # Volume tracking
  volumeToken0: BigDecimal!
  volumeToken1: BigDecimal!
  volumeUSD: BigDecimal!
  
  # Fee tracking
  feesUSD: BigDecimal!
  
  # Counts
  txCount: BigInt!
  
  # Timestamps
  createdAtTimestamp: BigInt!
  createdAtBlockNumber: BigInt!
}

# Individual swap event
type Swap @entity(immutable: true) {
  id: ID! # tx hash + log index
  pool: Pool!
  sender: Bytes!
  recipient: Bytes!
  amount0: BigDecimal!
  amount1: BigDecimal!
  amountUSD: BigDecimal!
  sqrtPriceX96: BigInt!
  tick: Int!
  timestamp: BigInt!
  blockNumber: BigInt!
  transaction: Bytes!
}

# Mint (add liquidity) event
type Mint @entity(immutable: true) {
  id: ID!
  pool: Pool!
  owner: Bytes!
  sender: Bytes!
  tickLower: Int!
  tickUpper: Int!
  amount: BigInt!
  amount0: BigDecimal!
  amount1: BigDecimal!
  amountUSD: BigDecimal!
  timestamp: BigInt!
  transaction: Bytes!
}

# Burn (remove liquidity) event
type Burn @entity(immutable: true) {
  id: ID!
  pool: Pool!
  owner: Bytes!
  tickLower: Int!
  tickUpper: Int!
  amount: BigInt!
  amount0: BigDecimal!
  amount1: BigDecimal!
  amountUSD: BigDecimal!
  timestamp: BigInt!
  transaction: Bytes!
}

# Daily pool data aggregation
type PoolDayData @entity {
  id: ID! # pool address + day timestamp
  pool: Pool!
  date: Int!
  
  # Volume
  volumeToken0: BigDecimal!
  volumeToken1: BigDecimal!
  volumeUSD: BigDecimal!
  
  # TVL at end of day
  tvlUSD: BigDecimal!
  
  # Fees
  feesUSD: BigDecimal!
  
  # Counts
  txCount: BigInt!
  
  # Price
  open: BigDecimal!
  high: BigDecimal!
  low: BigDecimal!
  close: BigDecimal!
}

# Hourly pool data for more granular tracking
type PoolHourData @entity {
  id: ID! # pool address + hour timestamp
  pool: Pool!
  periodStartTimestamp: Int!
  
  volumeToken0: BigDecimal!
  volumeToken1: BigDecimal!
  volumeUSD: BigDecimal!
  tvlUSD: BigDecimal!
  feesUSD: BigDecimal!
  txCount: BigInt!
}

# Protocol daily data
type ProtocolDayData @entity {
  id: ID! # day timestamp
  date: Int!
  totalVolumeUSD: BigDecimal!
  totalTVLUSD: BigDecimal!
  txCount: BigInt!
}

# ============================================
# USER DATA ENTITIES
# ============================================

# User entity - aggregates all user data
type User @entity {
  id: ID! # wallet address (lowercase)
  positions: [Position!]! @derivedFrom(field: "owner")
  veNFTs: [VeNFT!]! @derivedFrom(field: "owner")
  votes: [Vote!]! @derivedFrom(field: "user")
  totalPositions: BigInt!
  totalVeNFTs: BigInt!
}

# CL LP Position (from NonfungiblePositionManager)
type Position @entity {
  id: ID! # tokenId
  tokenId: BigInt!
  owner: User!
  pool: Pool!
  tickLower: Int!
  tickUpper: Int!
  liquidity: BigInt!
  depositedToken0: BigDecimal!
  depositedToken1: BigDecimal!
  withdrawnToken0: BigDecimal!
  withdrawnToken1: BigDecimal!
  collectedToken0: BigDecimal!
  collectedToken1: BigDecimal!
  staked: Boolean!
  stakedGauge: Bytes
  createdAtTimestamp: BigInt!
  createdAtBlockNumber: BigInt!
}

# Voting Escrow NFT (locked WIND)
type VeNFT @entity {
  id: ID! # tokenId
  tokenId: BigInt!
  owner: User!
  lockedAmount: BigDecimal!
  lockEnd: BigInt!
  votingPower: BigDecimal!
  isPermanent: Boolean!
  createdAtTimestamp: BigInt!
}

# Vote on a pool/gauge
type Vote @entity(immutable: true) {
  id: ID! # tx-logIndex
  user: User!
  veNFTId: BigInt!
  pool: Bytes!
  weight: BigInt!
  timestamp: BigInt!
  transaction: Bytes!
}

# Fee collection from position
type Collect @entity(immutable: true) {
  id: ID! # tx-logIndex
  position: Position!
  recipient: Bytes!
  amount0: BigDecimal!
  amount1: BigDecimal!
  timestamp: BigInt!
  transaction: Bytes!
}

# Position snapshot for historical tracking
type PositionSnapshot @entity(immutable: true) {
  id: ID!
  position: Position!
  liquidity: BigInt!
  depositedToken0: BigDecimal!
  depositedToken1: BigDecimal!
  timestamp: BigInt!
  blockNumber: BigInt!
}

# ============================================
# GOVERNANCE ENTITIES
# ============================================

# Governance Proposal
type Proposal @entity {
  id: ID! # proposalId (hex)
  proposalId: BigInt!
  proposer: Bytes!
  targets: [Bytes!]!
  values: [BigInt!]!
  calldatas: [Bytes!]!
  description: String!
  
  # Voting times (timestamps, not blocks)
  voteStart: BigInt!
  voteEnd: BigInt!
  
  # Vote tallies
  forVotes: BigInt!
  againstVotes: BigInt!
  abstainVotes: BigInt!
  
  # State tracking
  state: Int! # 0=Pending, 1=Active, 2=Canceled, 3=Defeated, 4=Succeeded, 5=Queued, 6=Expired, 7=Executed
  executed: Boolean!
  canceled: Boolean!
  
  # Timestamps
  createdAtTimestamp: BigInt!
  createdAtBlockNumber: BigInt!
  executedAtTimestamp: BigInt
}

# Individual vote on a proposal
type ProposalVote @entity(immutable: true) {
  id: ID! # proposalId-voter
  proposal: Proposal!
  voter: Bytes!
  tokenId: BigInt!
  support: Int! # 0=Against, 1=For, 2=Abstain
  weight: BigInt!
  timestamp: BigInt!
  transaction: Bytes!
}
